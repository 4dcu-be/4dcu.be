<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Kindle + Python = e-Ink Dashboard (part 2)</title>
  <meta name="description" content="In the last post a Kindle Paperwhite 3 was jailbroken, Python 3.8 installed and all boilerplate code was added to  have a way to start our script and launch ...">
  
  <meta name="author" content="Sebastian Proost">
  <meta name="copyright" content="&copy; Sebastian Proost 2020">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="In the last post a Kindle Paperwhite 3 was jailbroken, Python 3.8 installed and all boilerplate code was added to  have a way to start our script and launch ..." />
  <meta property="og:url" content="https://blog.4dcu.be/diy/2020/09/27/PythonKindleDashboard_2.html">
  <meta property="og:site_name" content="4DCu.be" />
  <meta property="og:title" content="Kindle + Python = e-Ink Dashboard (part 2)" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://blog.4dcu.be/assets/posts/2020-09-27-PythonKindleDashboard_1/kindle_pw3.jpg" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Kindle + Python = e-Ink Dashboard (part 2)">
  <meta name="twitter:description" content="In the last post a Kindle Paperwhite 3 was jailbroken, Python 3.8 installed and all boilerplate code was added to  have a way to start our script and launch ...">
  <meta name="twitter:image" content="https://blog.4dcu.be/assets/posts/2020-09-27-PythonKindleDashboard_1/kindle_pw3.jpg">
  <meta name="twitter:url" content="https://blog.4dcu.be/diy/2020/09/27/PythonKindleDashboard_2.html">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.4dcu.be/diy/2020/09/27/PythonKindleDashboard_2.html">
	<link rel="alternate" type="application/rss+xml" title="4DCu.be" href="https://blog.4dcu.be/feed.xml" />
	
	<!-- Tooltips -->
	<script type="text/javascript">
		window.tooltips = []
	</script>
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/icons/apple-icon-76x76.png" alt="4DCu.be">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	
	<li class="nav-link"><a href="/gallery/">Gallery</a>
	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

<li class="nav-link"><a href="#" class="nav-link-contact">Contact</a></li>

      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container has-cover" style="background-image: url(/assets/posts/2020-09-27-PythonKindleDashboard_1/kindle_pw3.jpg);">
  <div class="scrim has-cover ">
    <header class="post-header">
      <h1 class="title">Kindle + Python = e-Ink Dashboard (part 2)</h1>
			
      <p class="info"><em>repurposing an old kindle paperwhite 3</em></p>
			
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">Posted September 27, 2020 by Sebastian Proost</div>
  <div class="post-categories">
  in 
    
    <a href="/category/diy">Diy</a>
    
  
  </div>
</section>

<article class="post-content">
  <p>In the <a href="/diy/2020/09/27/PythonKindleDashboard_1.html">last post</a> a Kindle Paperwhite 3 was jailbroken, Python 3.8 installed and all boilerplate code was added to 
have a way to start our script and launch it from <a href="https://www.mobileread.com/forums/showthread.php?t=203326">KUAL</a>. Now we can actually dive into the actual Python code that
will turn the device in a proper DashBoard. To do this we’ll create a miniature ETL pipeline (Extract - Transform - Load),
that will fetch data from relevant websites (the extract part), combine it into a dictionary (the transform) and 
put all parts in an SVG image (the load). The latter can then be converted into a PNG which we can show on the screen.</p>

<p>So in this post we’ll create the last files shown in the file structure for our KUAL Dashboard extension, <em>run.py</em> and
<em>extract.py</em>. As always, all code for this project can be found on <a href="https://github.com/4dcu-be/kual-dashboard">GitHub</a>.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>│   .gitignore
│   README.md
│
└───dashboard
    │   config.xml
    │   menu.json
    │
    ├───bin
    │       extract.py
    │       run.py
    │       start.sh
    │       start_once.sh
    │
    └───cache
</code></pre></div></div>

<h2 id="coding-the-extract-functions">Coding the Extract Functions</h2>

<p>I have plenty of devices telling me the weather forecast, so I didn’t want to do yet another weather dashboard. Matter 
of fact, a lot of the code here is based on a KUAL Extension that does exactly that. Check it out <a href="https://github.com/x-magic/kindle-weather-stand-alone">here</a>
if you are looking to do a weather dashboard. I’ll pick something more specific for me, but it should be relatively 
easy to adapt the code to other websites and API’s to make a dashboard tailored to your own interests.</p>

<p>After some thinking I decided to pull data from three websites; <a href="https://scholar.google.com/citations?user=4niBmJUAAAAJ&amp;hl=en">Google Scholar</a> to grab the number of citations my
publications have received as well as my <a href="https://en.wikipedia.org/wiki/H-index">H-index</a>, my current <a href="https://www.playgwent.com/en/profile/sepro">Gwent</a> rank and score (a competitive online card-game) 
and from TVMaze air dates of upcoming episode for series I like. To avoid making the installation of this extension 
overly complicated, no additional packages will be used, so only the standard library will be used. Unfortunately, 
this means getting websites with <a href="https://docs.python.org/3/howto/urllib2.html">urllib</a> and regular expressions rather than <a href="https://requests.readthedocs.io/en/master/">requests</a> and <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a>. Though,
moving some complexity from the installation (jailbreaking a Kindle to get this to run is hard enough already) to the 
code is an acceptable trade-off.</p>

<h3 id="grabbing-data-from-google-scholar">Grabbing Data from Google Scholar</h3>

<p>All functions to grab and parse data from websites is contained in <em>extract.py</em>, my <a href="https://scholar.google.com/citations?user=4niBmJUAAAAJ&amp;hl=en">Google Scholar</a> page is the
easiest to parse so let’s start there.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="k">def</span> <span class="nf">get_google_scholar</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ssl_context</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">hits</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'&lt;td class="gsc_rsb_std"&gt;(\d+)&lt;/td&gt;'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'citations'</span><span class="p">,</span> <span class="s">'citations_recent'</span><span class="p">,</span> <span class="s">'h_index'</span><span class="p">,</span> <span class="s">'h_index_recent'</span><span class="p">,</span> <span class="s">'i10_index'</span><span class="p">,</span> <span class="s">'i10_index_recent'</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">hits</span><span class="p">))</span>
</code></pre></div></div>

<p>As far as getting and parsing an html page goes, this couldn’t be more straightforward. We use urllib to get the 
html data and with a single regular expression can get all fields in the table with the citation statistics. This should
give us six hits on each page and by using the zip and dict function it is possible to quickly merge those hits with the
correct names for the fields.</p>

<p>One odd thing is that the ssl_context needs to be created and added to the request. While the code works fine on
my computer without, it gives an error on the Kindle without this bit included.</p>

<h3 id="getting-the-gwent-profile-data">Getting the Gwent Profile Data</h3>

<p>While a few simple lines sufficed for <a href="https://scholar.google.com/citations?user=4niBmJUAAAAJ&amp;hl=en">Google Scholar</a>, getting the data from my <a href="https://www.playgwent.com/en/profile/sepro">Gwent</a> profile contains a lot more
ugly code. Here the lack of a proper package to parse HTML, like <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a>, is really tangible. However, while
not the prettiest code, it get’s the job done. It is just a matter of finding the spot in the HTML code where the piece
of information is located and writing up a regular expression to parse it out.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_gwent_data</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ssl_context</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'player'</span><span class="p">:</span>   <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'&lt;strong class="l-player-details__name"&gt;\\n\s+(.*?)&lt;/strong&gt;'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">html</span><span class="p">))),</span>
        <span class="s">'mmr'</span><span class="p">:</span>      <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'&lt;div class="l-player-details__table-mmr"&gt;.*?&lt;strong&gt;(.*?)&lt;/strong&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">html</span><span class="p">)))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">','</span><span class="p">,</span><span class="s">''</span><span class="p">),</span>
        <span class="s">'position'</span><span class="p">:</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'&lt;div class="l-player-details__table-position"&gt;.*?&lt;strong&gt;(.*?)&lt;/strong&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">html</span><span class="p">)))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">','</span><span class="p">,</span><span class="s">''</span><span class="p">),</span>
        <span class="s">'rank'</span><span class="p">:</span>     <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'&lt;span class="l-player-details__rank"&gt;&lt;strong&gt;(.*?)&lt;/strong&gt;&lt;/span&gt;'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">html</span><span class="p">))),</span>
        <span class="s">'ladder'</span><span class="p">:</span>   <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'&lt;div class="l-player-details__table-ladder" &gt;&lt;span&gt;(.*?)&lt;/span&gt;&lt;/div&gt;'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">html</span><span class="p">))),</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></div>

<p>Note that re.findall returns a list of all hits, which should contain one element here. Though rather than extracting
that hit with its index, the join function is used. Due to this little trick, if the <a href="https://www.playgwent.com/en/profile/sepro">Gwent</a> website is updated and the
regular expression won’t match the code won’t yield errors, it will just have an empty strings as values. If the values
no longer appear on the dashboard it is time to revise the code, but the other items will still work as planned.</p>

<h3 id="tvmaze">TVMaze</h3>

<p><a href="https://www.tvmaze.com/">TVMaze</a> has an API that returns JSON objects, so that is easy to convert to a dict and doesn’t need messing around with
regular expressions to parse out parts of HTML. However, here there is an extra complexity that data for each show (which
will be passed to the function as a list of IDs) has to be fetched first. If that contains a link to the upcoming episode
we need to get that endpoint additionally to find the name of the episode and the airdate.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_tvmaze_data</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span><span class="p">()</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">'http://api.tvmaze.com/shows/</span><span class="si">%</span><span class="s">d'</span> <span class="o">%</span> <span class="nb">id</span>
        <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ssl_context</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="n">links</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'_links'</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="s">'nextepisode'</span> <span class="ow">in</span> <span class="n">links</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">links</span><span class="p">[</span><span class="s">'nextepisode'</span><span class="p">][</span><span class="s">'href'</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="n">ssl_context</span><span class="p">)</span> <span class="k">as</span> <span class="n">episode_response</span><span class="p">:</span>
                    <span class="n">episode_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">episode_response</span><span class="p">)</span>
                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s">'name'</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'error'</span><span class="p">),</span>
                            <span class="s">'episode_name'</span><span class="p">:</span> <span class="n">episode_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'error'</span><span class="p">),</span>
                            <span class="s">'airdate'</span><span class="p">:</span> <span class="n">episode_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'airdate'</span><span class="p">,</span> <span class="s">'error'</span><span class="p">),</span>
                        <span class="p">}</span>
                    <span class="p">)</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">'airdate'</span><span class="p">])</span>
</code></pre></div></div>

<h2 id="catching-errors-with-a-decorator">Catching Errors with a Decorator</h2>

<p>As the data comes from the internet a few things can go wrong, the Kindle’s Wifi might not come up fast enough, or 
the internet might be down, or one of the websites times out … and these errors aren’t caught yet. I also don’t want
the dashboard to display empty information for an hour or more because one website was temporarily unreachable. To over-
come this issue a decorator can be created that will try to run one of the extract functions, if it works write a file
to disk with the output, if it fails load the previously written file and return that.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>

<span class="n">cache_dir</span> <span class="o">=</span> <span class="s">'/mnt/base-us/extensions/dashboard/cache/'</span>

<span class="k">def</span> <span class="nf">failwithcache</span><span class="p">(</span><span class="n">cache_file</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">deco_failwithcache</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="o">@</span><span class="n">wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">f_failwithcache</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">cache_file</span><span class="p">),</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">cache_file</span><span class="p">))</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output</span>
        <span class="k">return</span> <span class="n">f_failwithcache</span>
    <span class="k">return</span> <span class="n">deco_failwithcache</span>
</code></pre></div></div>

<p>To get this running we’ll need to decorate the extract functions like shown below. The decorator takes one argument, the 
filename to write to (potentially this could be done automatically based on the decorated function’s name).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">failwithcache</span><span class="p">(</span><span class="s">'scholar.json'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_google_scholar</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="o">...</span>

<span class="o">@</span><span class="n">failwithcache</span><span class="p">(</span><span class="s">'gwent.json'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_gwent_data</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div></div>

<h2 id="time-to-transform-and-load">Time to Transform and Load</h2>

<p>So now we have to finish <em>run.py</em> which will be called by the shell script every hour, run the extract functions,
combine the output and visualize it. Though let’s forget about that for a second and just create something that
puts some useful information on the screen. We can do a system call to <em>eips</em> which is a system tool available on the
kindle to draw something on the screen or, with the <em>-c</em> flag, clear the screen.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># bin/python3
# encoding: utf-8
</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">extract</span> <span class="kn">import</span> <span class="n">get_google_scholar</span><span class="p">,</span> <span class="n">get_gwent_data</span><span class="p">,</span> <span class="n">get_tvmaze_data</span>

<span class="n">scholar_url</span> <span class="o">=</span> <span class="s">"http://scholar.google.com/citations?user=4niBmJUAAAAJ&amp;hl=en"</span>
<span class="n">gwent_url</span> <span class="o">=</span> <span class="s">"http://www.playgwent.com/en/profile/sepro"</span>

<span class="n">tvmaze_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span>  <span class="c1"># The 100
</span>              <span class="mi">79</span><span class="p">,</span>  <span class="c1"># The Goldbergs
</span>              <span class="mi">38963</span><span class="p">,</span>  <span class="c1"># The Mandalorian
</span>              <span class="p">]</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="c1"># Load data. printing text here is for debugging only, should be removed later
</span>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips -c'</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  4 </span><span class="se">\'</span><span class="s">Loading Data ...</span><span class="se">\'</span><span class="s">'</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  6 </span><span class="se">\'</span><span class="s">Google Scholar ...</span><span class="se">\'</span><span class="s">'</span><span class="p">)</span>
    <span class="n">gs_data</span> <span class="o">=</span> <span class="n">get_google_scholar</span><span class="p">(</span><span class="n">scholar_url</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  7 </span><span class="se">\'</span><span class="s">Gwent ...</span><span class="se">\'</span><span class="s">'</span><span class="p">)</span>
    <span class="n">gwent_data</span> <span class="o">=</span> <span class="n">get_gwent_data</span><span class="p">(</span><span class="n">gwent_url</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  8 </span><span class="se">\'</span><span class="s">TVMaze ...</span><span class="se">\'</span><span class="s">'</span><span class="p">)</span>
    <span class="n">tvmaze_data</span> <span class="o">=</span> <span class="n">get_tvmaze_data</span><span class="p">(</span><span class="n">tvmaze_ids</span><span class="p">)</span>

    <span class="c1"># All data is loaded, let's put it on the screen
</span>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips -c'</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips -c'</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  2 </span><span class="se">\'</span><span class="s">Google Scholar</span><span class="se">\'</span><span class="s">'</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  4 </span><span class="se">\'</span><span class="s">H-index   : </span><span class="si">%</span><span class="s">s</span><span class="se">\'</span><span class="s">'</span> <span class="o">%</span> <span class="n">gs_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'h_index'</span><span class="p">,</span> <span class="s">'NA'</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  5 </span><span class="se">\'</span><span class="s">Citations : </span><span class="si">%</span><span class="s">s</span><span class="se">\'</span><span class="s">'</span> <span class="o">%</span> <span class="n">gs_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'citations'</span><span class="p">,</span> <span class="s">'NA'</span><span class="p">))</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  9 </span><span class="se">\'</span><span class="s">Gwent (</span><span class="si">%</span><span class="s">s)</span><span class="se">\'</span><span class="s">'</span> <span class="o">%</span> <span class="n">gwent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'ladder'</span><span class="p">,</span> <span class="s">'error'</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  11 </span><span class="se">\'</span><span class="s">Player    : </span><span class="si">%</span><span class="s">s</span><span class="se">\'</span><span class="s">'</span> <span class="o">%</span> <span class="n">gwent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'player'</span><span class="p">,</span> <span class="s">'NA'</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  12 </span><span class="se">\'</span><span class="s">MMR       : </span><span class="si">%</span><span class="s">s</span><span class="se">\'</span><span class="s">'</span> <span class="o">%</span> <span class="n">gwent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'mmr'</span><span class="p">,</span> <span class="s">'NA'</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  13 </span><span class="se">\'</span><span class="s">Position  : </span><span class="si">%</span><span class="s">s</span><span class="se">\'</span><span class="s">'</span> <span class="o">%</span> <span class="n">gwent_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'position'</span><span class="p">,</span> <span class="s">'NA'</span><span class="p">))</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  17 </span><span class="se">\'</span><span class="s">TVMaze</span><span class="se">\'</span><span class="s">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">episode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tvmaze_data</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="mi">19</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  </span><span class="si">%</span><span class="s">d </span><span class="se">\'</span><span class="si">%</span><span class="s">s: </span><span class="si">%</span><span class="s">s </span><span class="si">%</span><span class="s">s</span><span class="se">\'</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">episode</span><span class="p">[</span><span class="s">'name'</span><span class="p">],</span> <span class="n">episode</span><span class="p">[</span><span class="s">'episode_name'</span><span class="p">],</span> <span class="n">episode</span><span class="p">[</span><span class="s">'airdate'</span><span class="p">]))</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">'eips 15  26 </span><span class="se">\'</span><span class="s">Last Update  : </span><span class="si">%</span><span class="s">s</span><span class="se">\'</span><span class="s">'</span> <span class="o">%</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">d/</span><span class="si">%</span><span class="s">m/</span><span class="si">%</span><span class="s">Y, </span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S"</span><span class="p">))</span>

</code></pre></div></div>

<p>It works ! See the picture below how it looks on the Kindle. The font is ugly and small, but all information is pulled 
in and shown. I left it running overnight a couple days to catch errors (this is how I found out errors fetching data
needed to be handled and that the cache can not be written to the Kindle’s designated temp folder as it is cleared to 
frequently). So one more thing to do, make everything look nice!</p>


</article>



<section class="tags">
	<strong><i class="fa fa-tags"></i> Tags:</strong> <a href="/tag/python">python</a>,&nbsp;<a href="/tag/kindle">kindle</a>,&nbsp;<a href="/tag/dashboard">dashboard</a>
</section>



<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
      <a href="//twitter.com/share?text=Kindle+%2B+Python+%3D+e-Ink+Dashboard+%28part+2%29&url=https%3A%2F%2Fblog.4dcu.be%2Fdiy%2F2020%2F09%2F27%2FPythonKindleDashboard_2.html&via=ProostSebastian"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
        <i class="fa fa-twitter-square fa-lg"></i>
      </a>
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
      <a href="//www.facebook.com/sharer.php?t=Kindle+%2B+Python+%3D+e-Ink+Dashboard+%28part+2%29&u=https%3A%2F%2Fblog.4dcu.be%2Fdiy%2F2020%2F09%2F27%2FPythonKindleDashboard_2.html"
        onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    
    
    
    
    
    
  
    
    
    
    
    
      <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.4dcu.be%2Fdiy%2F2020%2F09%2F27%2FPythonKindleDashboard_2.html"
        onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;">
        <i class="fa fa-linkedin-square fa-lg"></i>
      </a>
    
    
    
    
  
</section>

	<section class="post-navigation">
		<span class="prev-post">
			
				<a href="/diy/2020/09/27/PythonKindleDashboard_1.html">
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-left fa-stack-1x fa-inverse"></i>
					</span>
					<span class="page-number">Kindle + Python = e-Ink Dashboard (part 1)</span>
				</a>
			
		</span>
		<span class="next-post">
			
		</span>
	</section>




<section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = '4dcube';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



</div>
</div>

    </div>

		<div class="modal micromodal-slide" id="modal-1" aria-hidden="true">
	<div class="modal__overlay" tabindex="-1" data-micromodal-close>
		<div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">
			<header class="modal__header">
				<h2 class="modal__title" id="modal-1-title">
					Contact
				</h2>
			</header>
			<main class="modal__content" id="modal-1-content">
				<p>Have any comments or suggestions, your are welcome to reach out !</p>
				<ul class="modal__list">
						<li>
	<i class="fa fa-envelope-o"></i>
	<a href="mailto:sebastian.proost@gmail.com">
		<span class="username">sebastian.proost@gmail.com</span>
	</a>
</li>


	
	<li>
		<i class="fa fa-twitter"></i>
		<a href="https://twitter.com/ProostSebastian" title="Follow me on Twitter">
			<span class="username">ProostSebastian</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/4dcu-be" title="Fork me on GitHub">
			<span class="username">4dcu-be</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/sepro" title="Fork me on GitHub">
			<span class="username">sepro</span>
		</a>
	</li>
	

	

	


				</ul>
			</main>
			<footer class="modal__footer">
				<button class="modal__btn modal__btn-primary" data-micromodal-close="" aria-label="Close this dialog window">Close</button>
			</footer>
		</div>
	</div>
</div>


    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">4DCu.be</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
				
	
	<li class="nav-link"><a href="/about/">About</a>
	

	

	
	<li class="nav-link"><a href="/gallery/">Gallery</a>
	

	

	
	<li class="nav-link"><a href="/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

<li class="nav-link"><a href="#" class="nav-link-contact">Contact</a></li>

      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
	<i class="fa fa-envelope-o"></i>
	<a href="mailto:sebastian.proost@gmail.com">
		<span class="username">sebastian.proost@gmail.com</span>
	</a>
</li>


	
	<li>
		<i class="fa fa-twitter"></i>
		<a href="https://twitter.com/ProostSebastian" title="Follow me on Twitter">
			<span class="username">ProostSebastian</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/4dcu-be" title="Fork me on GitHub">
			<span class="username">4dcu-be</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/sepro" title="Fork me on GitHub">
			<span class="username">sepro</span>
		</a>
	</li>
	

	

	


      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
      <p class="text">A blog about Programming (mostly in Python), Machine Learning, Gaming, Technology and more.</p>
			<p class="text">Last update: September 29, 2020</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/lightgallery.min.js"></script>
<script src="//unpkg.com/micromodal/dist/micromodal.min.js"></script>
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script>
	AOS.init({
   once: true,
   offset: -20,
   duration: 600
	});
</script>


<script type="text/javascript">
$(document).ready(function() {
  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });

});

</script>
<script type="text/javascript">
$(document).ready(function() {
		$(".post-content").lightGallery({
			 thumbnail:false,
			 selector: '.lightgallery-link'
		});
});
</script>

<!-- Contact Modal -->
<script type="text/javascript">
$(document).ready(function() {
	MicroModal.init();

	$('.nav-link-contact').click(function(ev) {
	  ev.preventDefault();
	  MicroModal.show('modal-1', {
	  		onClose: function() { $('.nav-link-contact').blur(); },
	  		disableFocus: true
	  });
	});

});
</script>





<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47068418-5', 'auto');
  ga('send', 'pageview', {
    'page': '/diy/2020/09/27/PythonKindleDashboard_2.html',
    'title': 'Kindle + Python = e-Ink Dashboard (part 2)'
  });
</script>


  </body>

</html>
