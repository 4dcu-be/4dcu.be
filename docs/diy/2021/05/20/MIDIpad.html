<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Tiny MIDI controller with Raspberry Pi Pico</title>
  <meta name="description" content="With a MIDI library available for the Raspberry Pi Pico making a little MIDI “piano” is relatively easy. The MacroPad which I build last month is the perfect...">
  
  <meta name="author" content="Sebastian Proost">
  <meta name="copyright" content="&copy; Sebastian Proost 2021">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="With a MIDI library available for the Raspberry Pi Pico making a little MIDI “piano” is relatively easy. The MacroPad which I build last month is the perfect..." />
  <meta property="og:url" content="https://blog.4dcu.be/diy/2021/05/20/MIDIpad.html">
  <meta property="og:site_name" content="4DCu.be" />
  <meta property="og:title" content="Tiny MIDI controller with Raspberry Pi Pico" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://blog.4dcu.be/assets/posts/2021-05-20-MIDIpad/midipad_header.jpg" />
  <meta property="og:image:type" content="image/jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Tiny MIDI controller with Raspberry Pi Pico">
  <meta name="twitter:description" content="With a MIDI library available for the Raspberry Pi Pico making a little MIDI “piano” is relatively easy. The MacroPad which I build last month is the perfect...">
  <meta name="twitter:image" content="https://blog.4dcu.be/assets/posts/2021-05-20-MIDIpad/midipad_header.jpg">
  <meta name="twitter:url" content="https://blog.4dcu.be/diy/2021/05/20/MIDIpad.html">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.4dcu.be/diy/2021/05/20/MIDIpad.html">
	<link rel="alternate" type="application/rss+xml" title="4DCu.be" href="https://blog.4dcu.be/feed.xml" />
	
	<!-- Tooltips -->
	<script type="text/javascript">
		window.tooltips = []
	</script>
</head>


  <body>

    <header class="navigation" role="banner">
	<div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/icons/apple-icon-76x76.png" alt="4DCu.be">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
				
				<li class="nav-link"><a href="/about/">About</a>
	
				<li class="nav-link"><a href="/gallery/">Gallery</a>
	
				<li class="nav-link"><a href="/posts/">Posts</a>
	
				<li class="nav-link"><a href="#" class="nav-link-contact">Contact</a></li>

      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container has-cover" style="background-image: url(/assets/posts/2021-05-20-MIDIpad/midipad_header.jpg);">
  <div class="scrim has-cover ">
    <header class="post-header">
      <h1 class="title">Tiny MIDI controller with Raspberry Pi Pico</h1>
			
      <p class="info"><em>reprogramming the MacroPad</em></p>
			
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">Posted May 20, 2021 by Sebastian Proost</div>
  <div class="post-categories">
  in 
    
    <a href="/category/diy">Diy</a>
    
  
  </div>
</section>

<article class="post-content">
  <p>With a MIDI library available for the Raspberry Pi Pico making a little MIDI “piano” is relatively easy. The MacroPad
which I build last month is the perfect little device to play around with this. If you are interested in how to connect
buttons and LEDs to a Pi Pico, check out that post <a href="/diy/2021/04/05/Macropad.html">here</a>!</p>

<p><a href="/assets/posts/2021-04-05-Macropad/macropad_finished2.jpg" class="lightgallery-link" data-sub-html="Macropad from a previous post, to be reprogrammed into a MIDI Keyboard">
<img src="/assets/posts/2021-04-05-Macropad/macropad_finished2.jpg" alt="Macropad from a previous post, to be reprogrammed into a MIDI Keyboard" data-src="/assets/posts/2021-04-05-Macropad/macropad_finished2.jpg" loading="lazy" />
</a></p>

<p>A MIDI controller behaves different from a USB keyboard; once a key is pressed it generates a MIDI signal that can be
picked up by a compatible instrument or software to produce a sound. The signal contains the note that needs to be 
played, but can also contain the velocity (how fast/hard a key is pressed). Furthermore,
it is possible to send signals to bend notes, set the volume of an instrument, … Keys also don’t repeat after being
pressed longer. So there are a number of thing to change in the code.</p>

<h2 id="getting-started">Getting started</h2>

<p>If you want to follow along exactly, first you’ll have to build my <a href="/diy/2021/04/05/Macropad.html">MacroPad</a>, though pretty much any Raspberry Pi Pico
with a few buttons attached will do. Just make sure to update the code below so that the pins correspond with your 
hardware.</p>

<p>The Raspberry Pi Pico will need to run <a href="https://circuitpython.readthedocs.io/">CircuitPython</a> for this to work, my <a href="/diy/2021/04/05/Macropad.html">MacroPad</a> already had this but if you
start from scratch you’ll have to flash the correct firmware to the Pico. Next, connect the Pico to a computer, it will
show up as a USB drive. Get the <a href="https://github.com/adafruit/Adafruit_CircuitPython_MIDI">AdaFruit MIDI</a> library, and copy the folder <code class="language-plaintext highlighter-rouge">adafruit_midi</code> (from the repo) to the
<code class="language-plaintext highlighter-rouge">lib</code> folder on the Pico (create the latter if necessary).</p>

<p>You will also need to install a tool that turns the signals from a MIDI device into music. For Windows there is a free
tool <a href="https://www.microsoft.com/en-us/p/piano-10/9wzdncrfj443?activetab=pivot:overviewtab">Piano 10</a> which is fine to start with. Look for it in the Microsoft store.</p>

<p>Finally, create a file <code class="language-plaintext highlighter-rouge">code.py</code> in the root of the Pico drive and add the code below. Restart the Pico, and done ! 
You now have a functional MIDI device. Though, let’s go over the code, so you can change the parts to match your project
in case you aren’t using an exact replica of my <a href="/diy/2021/04/05/Macropad.html">MacroPad</a>.</p>

<h2 id="turning-the-pico-in-a-midi-device">Turning the Pico in a MIDI device</h2>

<p>The full code is shown here, and we’ll go over it step by step below.</p>

<div class="language-python large-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">board</span>
<span class="kn">import</span> <span class="nn">digitalio</span>
<span class="kn">import</span> <span class="nn">pwmio</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">usb_midi</span>
<span class="kn">import</span> <span class="nn">adafruit_midi</span>

<span class="kn">from</span> <span class="nn">adafruit_midi.note_on</span> <span class="kn">import</span> <span class="n">NoteOn</span>
<span class="kn">from</span> <span class="nn">adafruit_midi.note_off</span> <span class="kn">import</span> <span class="n">NoteOff</span>
<span class="kn">from</span> <span class="nn">adafruit_midi.pitch_bend</span> <span class="kn">import</span> <span class="n">PitchBend</span>
<span class="kn">from</span> <span class="nn">adafruit_midi.control_change</span> <span class="kn">import</span> <span class="n">ControlChange</span>

<span class="n">midi</span> <span class="o">=</span> <span class="n">adafruit_midi</span><span class="p">.</span><span class="n">MIDI</span><span class="p">(</span><span class="n">midi_out</span><span class="o">=</span><span class="n">usb_midi</span><span class="p">.</span><span class="n">ports</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">out_channel</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"MacroPad MIDI Board"</span><span class="p">)</span>

<span class="c1"># Configuration, which LED pins are used, which buttons, how buttons map to notes
</span><span class="n">led_pins</span> <span class="o">=</span> <span class="p">[</span><span class="n">board</span><span class="p">.</span><span class="n">GP18</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP17</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP16</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP21</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP20</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP19</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP27</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP26</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP22</span><span class="p">]</span>
<span class="n">button_pins</span> <span class="o">=</span> <span class="p">[</span><span class="n">board</span><span class="p">.</span><span class="n">GP13</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP14</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP15</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP10</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP11</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP12</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP7</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP8</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP9</span><span class="p">]</span>

<span class="n">note_mapping</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s">"C3"</span><span class="p">,</span> <span class="s">"C2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"D3"</span><span class="p">,</span> <span class="s">"D2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"E3"</span><span class="p">,</span> <span class="s">"E2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"F3"</span><span class="p">,</span> <span class="s">"F2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"G3"</span><span class="p">,</span> <span class="s">"G2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"A3"</span><span class="p">,</span> <span class="s">"A2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"B3"</span><span class="p">,</span> <span class="s">"B2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"C4"</span><span class="p">,</span> <span class="s">"C3"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"G2"</span><span class="p">,</span> <span class="s">"G1"</span><span class="p">]</span>
    <span class="p">]</span>

<span class="c1"># Set up buttons
</span><span class="n">buttons</span> <span class="o">=</span> <span class="p">[</span><span class="n">digitalio</span><span class="p">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="k">for</span> <span class="n">bp</span> <span class="ow">in</span> <span class="n">button_pins</span><span class="p">]</span>

<span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="n">buttons</span><span class="p">:</span>
    <span class="n">btn</span><span class="p">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">digitalio</span><span class="p">.</span><span class="n">Direction</span><span class="p">.</span><span class="n">INPUT</span>
    <span class="n">btn</span><span class="p">.</span><span class="n">pull</span> <span class="o">=</span> <span class="n">digitalio</span><span class="p">.</span><span class="n">Pull</span><span class="p">.</span><span class="n">UP</span>

<span class="c1"># Set up LEDs
</span><span class="n">leds</span> <span class="o">=</span> <span class="p">[</span><span class="n">pwmio</span><span class="p">.</span><span class="n">PWMOut</span><span class="p">(</span><span class="n">lp</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">duty_cycle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">lp</span> <span class="ow">in</span> <span class="n">led_pins</span><span class="p">]</span>

<span class="c1"># Set Initial Duty Cycles to 0 for each LED
</span><span class="n">duty_cycles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">led_pins</span><span class="p">]</span>

<span class="c1"># Key and trigger states
</span><span class="n">pressed_keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">button_pins</span><span class="p">]</span>
<span class="n">triggered_keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">button_pins</span><span class="p">]</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">buttons</span><span class="p">):</span>
        <span class="n">pressed_keys</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">btn</span><span class="p">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">btn</span><span class="p">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">duty_cycles</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65025</span>
            
    
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">tk</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pressed_keys</span><span class="p">,</span> <span class="n">triggered_keys</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">pk</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tk</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"note %d started"</span> <span class="o">%</span> <span class="n">ix</span><span class="p">)</span>
            <span class="n">midi</span><span class="p">.</span><span class="n">send</span><span class="p">([</span><span class="n">NoteOn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">note_mapping</span><span class="p">[</span><span class="n">ix</span><span class="p">]])</span>
            <span class="n">triggered_keys</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">pk</span> <span class="ow">and</span> <span class="n">tk</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"note %d stopped"</span> <span class="o">%</span> <span class="n">ix</span><span class="p">)</span>
            <span class="n">triggered_keys</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">midi</span><span class="p">.</span><span class="n">send</span><span class="p">([</span><span class="n">NoteOff</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">note_mapping</span><span class="p">[</span><span class="n">ix</span><span class="p">]])</span>
     
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">led</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leds</span><span class="p">):</span>
        <span class="n">led</span><span class="p">.</span><span class="n">duty_cycle</span> <span class="o">=</span> <span class="n">duty_cycles</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="n">duty_cycles</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">duty_cycles</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</code></pre></div></div>

<p>After loading all libraries a midi object is created with <code class="language-plaintext highlighter-rouge">adafruit_midi.MIDI</code>, this one liner will also turn the
Pico into a USB MIDI instrument. Now we can send MIDI signals using <code class="language-plaintext highlighter-rouge">midi.send()</code>.</p>

<p>Next there are arrays defining which GPIO pins are connected to LEDs and buttons. This is how I wired up my device, 
unless you are building an exact replica you’ll have to change this to match your circuit. There also is a list of notes
that will be played if a button is pressed. These need to be te same length, and the elements correspond. For instance 
the LED connected to pin GP18, should be the one below the button connected to pin GP13 and when pressing that button 
it will play notes “C3” and “C2”. Here an array is used for each button so multiple notes can be triggered 
simultaneously, in this case playing a note, and the same note an octave higher. Similarly, you could also play an entire
chord at the time.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">led_pins</span> <span class="o">=</span> <span class="p">[</span><span class="n">board</span><span class="p">.</span><span class="n">GP18</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP17</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP16</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP21</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP20</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP19</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP27</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP26</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP22</span><span class="p">]</span>
<span class="n">button_pins</span> <span class="o">=</span> <span class="p">[</span><span class="n">board</span><span class="p">.</span><span class="n">GP13</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP14</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP15</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP10</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP11</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP12</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP7</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP8</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP9</span><span class="p">]</span>

<span class="n">note_mapping</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s">"C3"</span><span class="p">,</span> <span class="s">"C2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"D3"</span><span class="p">,</span> <span class="s">"D2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"E3"</span><span class="p">,</span> <span class="s">"E2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"F3"</span><span class="p">,</span> <span class="s">"F2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"G3"</span><span class="p">,</span> <span class="s">"G2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"A3"</span><span class="p">,</span> <span class="s">"A2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"B3"</span><span class="p">,</span> <span class="s">"B2"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"C4"</span><span class="p">,</span> <span class="s">"C3"</span><span class="p">],</span>
        <span class="p">[</span><span class="s">"G2"</span><span class="p">,</span> <span class="s">"G1"</span><span class="p">]</span>
    <span class="p">]</span>
</code></pre></div></div>

<p>After defining these, there is a bit of boilerplate code to initiate the LEDs and buttons. This is identical to 
the code in the MacroPad.</p>

<p>For a MIDI device keystrokes need to be handled differently than for a computer keyboard. If you hit a key on a piano and
hold it, it will not start repeating after a brief moment like hitting a letter key on your computers keyboard. So 
key presses are handled by keeping track of their state in two lists. As soon as a button is pressed, the corresponding
position in <code class="language-plaintext highlighter-rouge">pressed_keys</code> will be set to <code class="language-plaintext highlighter-rouge">True</code>, once it is released it will be set to false. 
The list <code class="language-plaintext highlighter-rouge">triggered_keys</code> is used to store for which keys a signal already has been sent.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Key and trigger states
</span><span class="n">pressed_keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">button_pins</span><span class="p">]</span>
<span class="n">triggered_keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">button_pins</span><span class="p">]</span>
</code></pre></div></div>

<p>The main loop will listen to key presses and handle them, note that the way the LEDs are handled is identical to the
previous post, so this will not be discussed here again (that part has been removed in the block below for readability).
The first thing that is done is loop over all buttons and check if they are pressed, if they are we set <code class="language-plaintext highlighter-rouge">pressed_keys</code>
to <code class="language-plaintext highlighter-rouge">True</code>. Next, we loop over <code class="language-plaintext highlighter-rouge">pressed_keys</code> and <code class="language-plaintext highlighter-rouge">triggered_keys</code> and check for keys which are pressed down
and have not triggered a MIDI signal. If that is the case, the Note On signal is send and <code class="language-plaintext highlighter-rouge">triggered_keys</code> set to
<code class="language-plaintext highlighter-rouge">True</code>. The line <code class="language-plaintext highlighter-rouge">midi.send([NoteOn(a, 60) for a in note_mapping[ix]])</code> will send the event for all notes
linked with that button. The velocity, the number <code class="language-plaintext highlighter-rouge">60</code>, here is constant as there is no way to check how hard/fast
a button was pressed.</p>

<p>Keys which are no longer pressed down and which are still in a triggered state require a Note Off signal to
be emitted, this is done similarly to setting a Note On with <code class="language-plaintext highlighter-rouge">midi.send([NoteOff(a, 0) for a in note_mapping[ix]])</code>.
Here <code class="language-plaintext highlighter-rouge">triggered_keys</code> is set to <code class="language-plaintext highlighter-rouge">False</code> for the released button.</p>

<p>As there is no need to do anything when <code class="language-plaintext highlighter-rouge">pressed_keys</code> and <code class="language-plaintext highlighter-rouge">triggered_keys</code> are in the same state we wait for
a brief moment with <code class="language-plaintext highlighter-rouge">time.sleep(0.01)</code> before the loop repeats the entire block.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">buttons</span><span class="p">):</span>
        <span class="n">pressed_keys</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">btn</span><span class="p">.</span><span class="n">value</span>

    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">tk</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pressed_keys</span><span class="p">,</span> <span class="n">triggered_keys</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">pk</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tk</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"note %d started"</span> <span class="o">%</span> <span class="n">ix</span><span class="p">)</span>
            <span class="n">midi</span><span class="p">.</span><span class="n">send</span><span class="p">([</span><span class="n">NoteOn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">note_mapping</span><span class="p">[</span><span class="n">ix</span><span class="p">]])</span>
            <span class="n">triggered_keys</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">pk</span> <span class="ow">and</span> <span class="n">tk</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"note %d stopped"</span> <span class="o">%</span> <span class="n">ix</span><span class="p">)</span>
            <span class="n">triggered_keys</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">midi</span><span class="p">.</span><span class="n">send</span><span class="p">([</span><span class="n">NoteOff</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">note_mapping</span><span class="p">[</span><span class="n">ix</span><span class="p">]])</span>

    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="connecting-with-midi-software">Connecting with MIDI software</h2>

<p>If everything is properly working, the Pi Pico should now show up as a MIDI device in software that can work with 
MIDI controller. In Piano10 click the MIDI button and select the Pico as the input device as shown below.
Once you start pressing keys, Piano10 will highlight the notes played on the on-screen keyboard and play the
sound.</p>

<p><a href="/assets/posts/2021-05-20-MIDIpad/piano10.jpg" class="lightgallery-link" data-sub-html="Piano10 MIDI settings, select the Pico as the input device">
<img src="/assets/posts/2021-05-20-MIDIpad/piano10.jpg" alt="Piano10 MIDI settings, select the Pico as the input device" data-src="/assets/posts/2021-05-20-MIDIpad/piano10.jpg" loading="lazy" />
</a></p>

<h2 id="songs-you-can-play-with-nine-keys">Songs you can play with nine keys</h2>

<p>As the buttons can be reprogrammed, you can essentially play songs with up to nine notes. With a simple diatonic one 
octave scale there are plenty of nursery rhymes you can play. “Frère Jacques”, “Twinkle Twinkle Little Star”, 
“Row Row Row Your Boat”, “Oh Susanna”, “Oh, When The Saints”, …</p>

<p>If you do reprogram some buttons you could play “Happy Birthday”, “7 Nation Army” (The White Stripes), and probably 
many, many more.</p>

<p>You could also map each button to “strum” a full guitar chord which would let you play a few sing-alongs. However, without
strumming patterns it might sound a bit flat and uninteresting.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Having a very “clicky” keypad as a MIDI controller isn’t the best, you probably want something with quieter
buttons. Though as a proof-of-concept how to set up Raspberry Pi Pico as a MIDI controller it is a great demo! While
you’ll probably outgrow the nine buttons of this keyboard if you are serious about creating music, it is a fun way to 
get into creating/working with MIDI devices and maybe learning how to play a few nursery rhymes along the way.</p>


</article>



<section class="tags">
	<strong><i class="fa fa-tags"></i> Tags:</strong> <a href="/tag/raspberry-pi">raspberry-pi</a>,&nbsp;<a href="/tag/python">python</a>,&nbsp;<a href="/tag/mechanical-keyboard">mechanical-keyboard</a>,&nbsp;<a href="/tag/soldering">soldering</a>,&nbsp;<a href="/tag/electronics">electronics</a>,&nbsp;<a href="/tag/midi">midi</a>
</section>



<section class="rss">
	
	<p class="rss-subscribe text">Liked this post ? <strong><a href="https://buymeacoffee.com/4dcube">Buy me a Coffee <i class="fa fa-coffee"></i></a></strong></p>
	
</section>

<section class="share">
  <span>Share: </span>
  
    
    
      <a href="//twitter.com/share?text=Tiny+MIDI+controller+with+Raspberry+Pi+Pico&url=https%3A%2F%2Fblog.4dcu.be%2Fdiy%2F2021%2F05%2F20%2FMIDIpad.html&via=ProostSebastian"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
        <i class="fa fa-twitter-square fa-lg"></i>
      </a>
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
      <a href="//www.facebook.com/sharer.php?t=Tiny+MIDI+controller+with+Raspberry+Pi+Pico&u=https%3A%2F%2Fblog.4dcu.be%2Fdiy%2F2021%2F05%2F20%2FMIDIpad.html"
        onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    
    
    
    
    
    
  
    
    
    
    
    
      <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.4dcu.be%2Fdiy%2F2021%2F05%2F20%2FMIDIpad.html"
        onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;">
        <i class="fa fa-linkedin-square fa-lg"></i>
      </a>
    
    
    
    
  
</section>

	<section class="post-navigation">
		<span class="prev-post">
			
				<a href="/programming/2021/05/03/Interactive-Visualizations.html">
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-left fa-stack-1x fa-inverse"></i>
					</span>
					<span class="page-number">Altair + Vega + Justcharts = Interactive Visualisations in Static Websites</span>
				</a>
			
		</span>
		<span class="next-post">
			
				<a href="/diy/2021/06/14/Stickers.html">
					<span class="page-number">Making Stickers</span>
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-right fa-stack-1x fa-inverse"></i>
					</span>
				</a>
			
		</span>
	</section>




<section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = '4dcube';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



</div>
</div>

    </div>

		<div class="modal micromodal-slide" id="modal-1" aria-hidden="true">
	<div class="modal__overlay" tabindex="-1" data-micromodal-close>
		<div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">
			<header class="modal__header">
				<h2 class="modal__title" id="modal-1-title">
					Contact
				</h2>
			</header>
			<main class="modal__content" id="modal-1-content">
				<p>Have any comments or suggestions, your are welcome to reach out !</p>
				<ul class="modal__list">
						<li>
	<i class="fa fa-envelope-o"></i>
	<a href="mailto:sebastian.proost@gmail.com">
		<span class="username">sebastian.proost@gmail.com</span>
	</a>
</li>


	
	<li>
		<i class="fa fa-twitter"></i>
		<a href="https://twitter.com/ProostSebastian" title="Follow me on Twitter">
			<span class="username">ProostSebastian</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/4dcu-be" title="Fork me on GitHub">
			<span class="username">4dcu-be</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/sepro" title="Fork me on GitHub">
			<span class="username">sepro</span>
		</a>
	</li>
	

	

	


				</ul>
				
				<br />
				<p>Do you like this blog and wish to contribute? You could <a href="https://buymeacoffee.com/4dcube">Buy me a Coffee <i class="fa fa-coffee"></i></a>!</p>
				
			</main>
			<footer class="modal__footer">
				<button class="modal__btn modal__btn-primary" data-micromodal-close="" aria-label="Close this dialog window">Close</button>
			</footer>
		</div>
	</div>
</div>


    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">4DCu.be</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
				
				<li class="nav-link"><a href="/about/">About</a>
	
				<li class="nav-link"><a href="/gallery/">Gallery</a>
	
				<li class="nav-link"><a href="/posts/">Posts</a>
	
				<li class="nav-link"><a href="#" class="nav-link-contact">Contact</a></li>

      </ul>
    </div>

    <div class="site-contact">
      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
	<i class="fa fa-envelope-o"></i>
	<a href="mailto:sebastian.proost@gmail.com">
		<span class="username">sebastian.proost@gmail.com</span>
	</a>
</li>


	
	<li>
		<i class="fa fa-twitter"></i>
		<a href="https://twitter.com/ProostSebastian" title="Follow me on Twitter">
			<span class="username">ProostSebastian</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/4dcu-be" title="Fork me on GitHub">
			<span class="username">4dcu-be</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/sepro" title="Fork me on GitHub">
			<span class="username">sepro</span>
		</a>
	</li>
	

	

	


      </ul>
    </div>

    <div class="site-signature">
			
			<p><strong>Contribute</strong></p>
			<p><i class="fa fa-coffee"></i> <a href="https://buymeacoffee.com/4dcube">Buy me a Coffee </a></p>
			<br />
			
      <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
			
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="/js/lightgallery.min.js"></script>
<script src="//unpkg.com/micromodal/dist/micromodal.min.js"></script>
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script>
	AOS.init({
   once: true,
   offset: -20,
   duration: 600
	});
</script>


<script type="text/javascript">
$(document).ready(function() {
  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });

});

</script>
<script type="text/javascript">
$(document).ready(function() {
		$(".post-content").lightGallery({
			 thumbnail:false,
			 selector: '.lightgallery-link'
		});
});
</script>

<!-- Contact Modal -->
<script type="text/javascript">
$(document).ready(function() {
	MicroModal.init();

	$('.nav-link-contact').click(function(ev) {
	  ev.preventDefault();
	  MicroModal.show('modal-1', {
	  		onClose: function() { $('.nav-link-contact').blur(); },
	  		disableFocus: true
	  });
	});

});
</script>





<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47068418-5', 'auto');
  ga('send', 'pageview', {
    'page': '/diy/2021/05/20/MIDIpad.html',
    'title': 'Tiny MIDI controller with Raspberry Pi Pico'
  });
</script>


  </body>

</html>
