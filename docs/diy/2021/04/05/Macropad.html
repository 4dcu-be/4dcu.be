<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>A Python powered MacroPad/StreamDeck</title>
  <meta name="description" content="I decided to put left-over parts from my mechanical keyboard and a Raspberry Pi Pico to good use and build a  MacroPad. This is a small keypad, where each sw...">
  
  <meta name="author" content="Sebastian Proost">
  <meta name="copyright" content="&copy; Sebastian Proost 2023">
  

  <!-- External libraries -->
	<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="I decided to put left-over parts from my mechanical keyboard and a Raspberry Pi Pico to good use and build a  MacroPad. This is a small keypad, where each sw..." />
  <meta property="og:url" content="https://blog.4dcu.be/diy/2021/04/05/Macropad.html">
  <meta property="og:site_name" content="4DCu.be" />
  <meta property="og:title" content="A Python powered MacroPad/StreamDeck" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://blog.4dcu.be/assets/posts/2021-04-05-Macropad/macropad_finished.jpg" />
  <meta property="og:image:type" content="image/jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="A Python powered MacroPad/StreamDeck">
  <meta name="twitter:description" content="I decided to put left-over parts from my mechanical keyboard and a Raspberry Pi Pico to good use and build a  MacroPad. This is a small keypad, where each sw...">
  <meta name="twitter:image" content="https://blog.4dcu.be/assets/posts/2021-04-05-Macropad/macropad_finished.jpg">
  <meta name="twitter:url" content="https://blog.4dcu.be/diy/2021/04/05/Macropad.html">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/pagefind/pagefind-ui.css">
  <link rel="canonical" href="https://blog.4dcu.be/diy/2021/04/05/Macropad.html">
	<link rel="alternate" type="application/rss+xml" title="4DCu.be" href="https://blog.4dcu.be/feed.xml" />
	<link rel="stylesheet" href="/css/main.css">

	<!-- PageFind -->
	<script src="/pagefind/pagefind-ui.js" type="text/javascript"></script>


	<!-- Tooltips -->
	<script type="text/javascript">
		window.tooltips = []
	</script>

	<script type='text/javascript'>
	//<![CDATA[
	function loadCSS(e, t, n) { "use strict"; var i = window.document.createElement("link"); var o = t || window.document.getElementsByTagName("script")[0]; i.rel = "stylesheet"; i.href = e; i.media = "only x"; o.parentNode.insertBefore(i, o); setTimeout(function () { i.media = n || "all" }) }loadCSS("https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css");
	//]]>
	</Script>
</head>


  <body>

    <header class="navigation" role="banner">
	<div class="navigation-wrapper">
    <a href="/" class="logo">
      
      <img src="/assets/icons/apple-icon-76x76.png" alt="4DCu.be" width="58" height="58" />
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
				
				<li class="nav-link"><a href="/about/">About</a>
	
				<li class="nav-link"><a href="/gallery/">Gallery</a>
	
				<li class="nav-link"><a href="/posts/">Posts</a>
	
				<li class="nav-link"><a href="#" class="nav-link-contact">Contact</a></li>
<li class="nav-link"><a href="#" class="nav-link-search"><i class="fa fa-search" style="width:16px;height:16px"></i></a></li>

      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <img data-pagefind-meta="image[src]" src="/assets/images/thumbnails/macropad.jpg" style="display:none" />
<div class="post">

<div class="post-header-container has-cover" style="background-image: url(/assets/posts/2021-04-05-Macropad/macropad_finished.jpg);">
  <div class="scrim has-cover ">
    <header class="post-header">
      <h1 class="title">A Python powered MacroPad/StreamDeck</h1>
			
      <p class="info"><em>with a Raspberry Pi Pico</em></p>
			
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">Posted April 5, 2021 by Sebastian Proost</div>
  <div class="post-categories">
  in 
    
    <a href="/category/diy">Diy</a>
    
  
  </div>
</section>

<article class="post-content">
  <p>I decided to put left-over parts from my <a href="/diy/2020/05/01/Mechanical-Keyboard.html">mechanical keyboard</a> and a Raspberry Pi Pico to good use and build a 
MacroPad. This is a small keypad, where each switch can be programmed with a certain button or
combination of buttons to quickly execute often needed shortcuts. Streamers often have this
to change scenes or trigger an animation in OBS, hence these are often referred to as StreamDecks.</p>

<p><a href="/assets/posts/2021-04-05-Macropad/macropad_finished2.jpg" class="lightgallery-link" data-sub-html="Completed MacroPad">
<img src="/assets/posts/2021-04-05-Macropad/macropad_finished2.jpg" alt="Completed MacroPad" height="800" width="1200" data-src="/assets/posts/2021-04-05-Macropad/macropad_finished2.jpg" loading="lazy" />
</a></p>

<h2 id="requirements">Requirements</h2>

<p>For this project I had a lot of the components at hand. Switches, LEDs and keycaps were left over from my keyboard build.
If you do want to do this from scratch, here is a list of items to buy.</p>

<ul>
  <li>1x a MacroPad case (3D printed, STL <a href="/assets/posts/2021-04-05-Macropad/2021-04-05-Macropad-STL.zip">here</a>)</li>
  <li>1x a <strong>Raspberry Pi Pico</strong></li>
  <li>9x Mechanical keyboard <strong>switches</strong> (Gateron, Cherry MX, Kailh… should all fit)</li>
  <li>a set of <strong>keycaps</strong> (e.g. for numpad keys)</li>
  <li>9x 1.8 mm 2V <strong>LEDs</strong> (current 15-20 mA) (optional)</li>
  <li>9x 82 Ohm <strong>resistors</strong> (optional)</li>
  <li>1x a switch opener (optional)</li>
  <li>4x M3 bolts (1 cm long)</li>
  <li>some heat-shrink tubing</li>
  <li>wire, single core and flexible</li>
  <li>soldering equipment</li>
  <li>a third hand tool</li>
  <li>a hot-glue gun</li>
  <li>a USB-micro cable</li>
</ul>

<h2 id="designing-and-printing-the-case">Designing and printing the case</h2>

<p>As there were no 3x3 MacroPad cases that would fit a Raspberry Pi Pico, I 
<a href="/diy/2020/12/15/Editing-STL.html">mixed</a> two designs using Blender to create a suited case. I started with 
<a href="https://www.thingiverse.com/thing:4222157">a design</a> that uses a Pro Micro at the core and 
replaced the bits that hold the Pro Micro with the inside part from a <a href="https://core-electronics.com.au/tutorials/3d-printable-case-for-raspberry-pi-pico.html">pico case</a>.
In addition, I made the case a bit higher as more wires need to fit inside. The result was a nice case with a spot that
holds a Raspberry Pi Pico perfectly. I prefer PETG printed using <a href="/diy/2020/02/25/3D-printing.html">these settings</a>, 
but PLA will do just fine as well.</p>

<p><a href="/assets/posts/2021-04-05-Macropad/macropad_case.jpg" class="lightgallery-link" data-sub-html="3D printed case, design is a mix of two existing designs">
<img src="/assets/posts/2021-04-05-Macropad/macropad_case.jpg" alt="3D printed case, design is a mix of two existing designs" height="800" width="1200" data-src="/assets/posts/2021-04-05-Macropad/macropad_case.jpg" loading="lazy" />
</a></p>

<p>If you want to print this yourself, grab my design from <a href="https://www.thingiverse.com/thing:4816077">Thingiverse</a> or
you download the STL files <a href="/assets/posts/2021-04-05-Macropad/2021-04-05-Macropad-STL.zip">here</a> directly.</p>

<h2 id="finishing-the-case">Finishing the case</h2>

<p>I wanted to match the case with my current keyboard, which has a dark gray anodized aluminium case. To do this, after
sanding and priming the case a black base coat was applied. Next, some Vallejo Gun Metal (acrylic paint
for miniatures) was applied by dabbing it on with a sponge. Finally, a few layers clear coat were applied so seal the
paint and provide a finish that is durable and more pleasant to touch.</p>

<p><a href="/assets/posts/2021-04-05-Macropad/with_keyboard.jpg" class="lightgallery-link" data-sub-html="Side by side comparison with my keyboard">
<img src="/assets/posts/2021-04-05-Macropad/with_keyboard.jpg" alt="Side by side comparison with my keyboard" height="800" width="1200" data-src="/assets/posts/2021-04-05-Macropad/with_keyboard.jpg" loading="lazy" />
</a></p>

<h2 id="preparing-the-switches">Preparing the switches</h2>

<p>(If you opt to forgo the LEDs this step can be skipped.)</p>

<p>For this project I used Gateron Green mechanical switches, while these have space to fit a 1.8 mm LED, the switch needs
to be opened to install them. This can be done using a special tool, which can be 3D printed. I used 
<a href="https://www.thingiverse.com/thing:2815698">this one</a>, which worked quite well. Note that some switches, e.g. Kailh, are
open on one end, so LEDs can be fitted without opening the case.</p>

<h2 id="hand-wiring-the-switches">Hand-wiring the switches</h2>

<p>First install the switches in the case, the snap in place but pay attention to the orientation. I decided for a 
North-Facing configuration where the LEDs are located on the upper part of the switch, this looks better with 
translucent keycaps. A resistor was installed on each switch from the LED’s ground to one pin of the
switch (see below). These were then connected together for all nine switches equipped with LEDs and the Pi Pico’s 
ground. A wire was soldered to the other pins of the switches and LEDs and these all went to their own GPIO pin to 
ensure all LEDs can be controlled individually and switches can be read directly.</p>

<p><a href="/assets/posts/2021-04-05-Macropad/switch_resistor.jpg" class="lightgallery-link" data-sub-html="One switch with LED and resistor installed">
<img src="/assets/posts/2021-04-05-Macropad/switch_resistor.jpg" alt="One switch with LED and resistor installed" height="800" width="1200" data-src="/assets/posts/2021-04-05-Macropad/switch_resistor.jpg" loading="lazy" />
</a></p>

<p>The picture above shows how each resistor was wired up to the ground of the LED and the switch. All grounds were then
soldered together with a long wire and connected to the Pico’s GND pad. The other two pins (here shown with red wires) 
were connected with GPIO pins, the full diagram is shown below.</p>

<p><a href="/assets/posts/2021-04-05-Macropad/wiring_scheme.png" class="lightgallery-link" data-sub-html="Full wiring scheme">
<img src="/assets/posts/2021-04-05-Macropad/wiring_scheme.png" alt="Full wiring scheme" height="775" width="1291" data-src="/assets/posts/2021-04-05-Macropad/wiring_scheme.png" loading="lazy" />
</a></p>

<h2 id="preparing-the-raspberry-pi-pico">Preparing the Raspberry Pi Pico</h2>

<p>Before any Python code can run, we need to install the correct firmware on the Pico. The <a href="https://github.com/adafruit/Adafruit_CircuitPython_HID">Adafruit HID</a> library 
which makes it possible to emulate keystrokes is only available for <a href="https://circuitpython.readthedocs.io/">CircuitPython</a> only. 
(I couldn’t find an equivalent for MicroPython) To set everything up I recommend going through a few videos 
from <a href="https://www.youtube.com/channel/UCrjKdwxaQMSV_NDywgKXVmw">Novatech Spirit</a>. He has 
excellent <a href="https://www.youtube.com/watch?v=MjCFJCfq8ko">instructions</a> on how to set up the Thonny IDE, CircuitPython
and the Adafruit HID library. <a href="https://www.youtube.com/watch?v=aEWptdD32iA">Another video</a> on his channel explains 
how to make a simple MacroPad, and the code below is based on this project. However, where he copy-pastes code for each
button, here a more elegant solution is included and there are a few additional tricks necessary to get the buttons to 
works with animated LEDs.</p>

<p>In a nutshell, download the <a href="https://circuitpython.readthedocs.io/">CircuitPython</a> .UF2 file first. Hold the BOOT_SEL button on the Pi Pico when connecting it to the
PC. The Pi will show up as a drive, copy the .UF2 file to this drive, and the device will reboot. Once it shows up again, it will
be mounted as a drive as before but with new files there, download the <a href="https://github.com/adafruit/Adafruit_CircuitPython_HID">Adafruit HID</a> code and copy the folder
<code class="language-plaintext highlighter-rouge">adafruit_hid</code> to the Pi’s <code class="language-plaintext highlighter-rouge">lib</code> folder. The code below should be put in <code class="language-plaintext highlighter-rouge">code.py</code> on the Pico.</p>

<h2 id="the-code">The code</h2>

<p>The code consists of two main parts. The first part, after importing the libraries are configurations, defines which 
GPIO pins are connected for LEDs and buttons as well as 
which keys we want to map the buttons to. Important is that everything in these lists is in the
correct order. Then the keyboard, buttons and PWM cycles for the LEDs are also initiated. Two arrays, <code class="language-plaintext highlighter-rouge">duty_cycles</code> and
<code class="language-plaintext highlighter-rouge">last_pressed</code> are created to keep track of each LEDs current brightness and how long it was since a key was last
pressed.</p>

<p>Once the code that tells the microcontroller which hardware is connected and how it needs to listen for button presses
and act accordingly. Since CircuitPython doesn’t seem to support multi-threading or interrupts on the Pi Pico, 
everything has to be done in the main loop. This consists of a few steps that are repeated over and over…</p>

<ul>
  <li>Check if a button (on the MacroPad) was pressed, and set a value in <code class="language-plaintext highlighter-rouge">last_pressed</code> if necessary and set the
button’s LED to full brightness in <code class="language-plaintext highlighter-rouge">duty_cycles</code></li>
  <li>Emulate button presses as a HID device if required</li>
  <li>Emulate button releases as a HID device if required</li>
  <li>Decrease <code class="language-plaintext highlighter-rouge">last_pressed</code></li>
  <li>Update the LEDs duty cycles and decrease the values in <code class="language-plaintext highlighter-rouge">duty_cylces</code> to fade them out</li>
  <li>Sleep for a minimal amount</li>
</ul>

<div class="language-python large-code highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">board</span>
<span class="kn">import</span> <span class="nn">digitalio</span>
<span class="kn">import</span> <span class="nn">pwmio</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">usb_hid</span>
<span class="kn">from</span> <span class="nn">adafruit_hid.keyboard</span> <span class="kn">import</span> <span class="n">Keyboard</span>
<span class="kn">from</span> <span class="nn">adafruit_hid.keycode</span> <span class="kn">import</span> <span class="n">Keycode</span>

<span class="c1"># Configuration, which LED pins are used, which buttons, how buttons map to macros
</span><span class="n">led_pins</span> <span class="o">=</span> <span class="p">[</span><span class="n">board</span><span class="p">.</span><span class="n">GP18</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP17</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP16</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP21</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP20</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP19</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP27</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP26</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP22</span><span class="p">]</span>
<span class="n">button_pins</span> <span class="o">=</span> <span class="p">[</span><span class="n">board</span><span class="p">.</span><span class="n">GP13</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP14</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP15</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">GP10</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP11</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP12</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP7</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP8</span><span class="p">,</span><span class="n">board</span><span class="p">.</span><span class="n">GP9</span><span class="p">]</span>

<span class="n">button_mapping</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="n">Keycode</span><span class="p">.</span><span class="n">LEFT_CONTROL</span><span class="p">,</span> <span class="n">Keycode</span><span class="p">.</span><span class="n">F1</span><span class="p">],</span>
    <span class="p">[</span><span class="n">Keycode</span><span class="p">.</span><span class="n">LEFT_CONTROL</span><span class="p">,</span> <span class="n">Keycode</span><span class="p">.</span><span class="n">F2</span><span class="p">],</span>
    <span class="p">[</span><span class="n">Keycode</span><span class="p">.</span><span class="n">LEFT_CONTROL</span><span class="p">,</span> <span class="n">Keycode</span><span class="p">.</span><span class="n">F3</span><span class="p">],</span>
    <span class="p">[</span><span class="n">Keycode</span><span class="p">.</span><span class="n">LEFT_CONTROL</span><span class="p">,</span> <span class="n">Keycode</span><span class="p">.</span><span class="n">F4</span><span class="p">],</span>
    <span class="p">[</span><span class="n">Keycode</span><span class="p">.</span><span class="n">LEFT_CONTROL</span><span class="p">,</span> <span class="n">Keycode</span><span class="p">.</span><span class="n">F5</span><span class="p">],</span>
    <span class="p">[</span><span class="n">Keycode</span><span class="p">.</span><span class="n">LEFT_CONTROL</span><span class="p">,</span> <span class="n">Keycode</span><span class="p">.</span><span class="n">F6</span><span class="p">],</span>
    <span class="p">[</span><span class="n">Keycode</span><span class="p">.</span><span class="n">LEFT_CONTROL</span><span class="p">,</span> <span class="n">Keycode</span><span class="p">.</span><span class="n">F7</span><span class="p">],</span>
    <span class="p">[</span><span class="n">Keycode</span><span class="p">.</span><span class="n">LEFT_CONTROL</span><span class="p">,</span> <span class="n">Keycode</span><span class="p">.</span><span class="n">F8</span><span class="p">],</span>
    <span class="p">[</span><span class="n">Keycode</span><span class="p">.</span><span class="n">LEFT_CONTROL</span><span class="p">,</span> <span class="n">Keycode</span><span class="p">.</span><span class="n">F9</span><span class="p">]]</span>


<span class="n">keyboard</span> <span class="o">=</span> <span class="n">Keyboard</span><span class="p">(</span><span class="n">usb_hid</span><span class="p">.</span><span class="n">devices</span><span class="p">)</span>
    
<span class="c1"># Set up buttons
</span><span class="n">buttons</span> <span class="o">=</span> <span class="p">[</span><span class="n">digitalio</span><span class="p">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="k">for</span> <span class="n">bp</span> <span class="ow">in</span> <span class="n">button_pins</span><span class="p">]</span>

<span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="n">buttons</span><span class="p">:</span>
    <span class="n">btn</span><span class="p">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">digitalio</span><span class="p">.</span><span class="n">Direction</span><span class="p">.</span><span class="n">INPUT</span>
    <span class="n">btn</span><span class="p">.</span><span class="n">pull</span> <span class="o">=</span> <span class="n">digitalio</span><span class="p">.</span><span class="n">Pull</span><span class="p">.</span><span class="n">UP</span>

<span class="c1"># Set up LEDs
</span><span class="n">leds</span> <span class="o">=</span> <span class="p">[</span><span class="n">pwmio</span><span class="p">.</span><span class="n">PWMOut</span><span class="p">(</span><span class="n">lp</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">duty_cycle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">lp</span> <span class="ow">in</span> <span class="n">led_pins</span><span class="p">]</span>

<span class="c1"># Set Initial Duty Cycles to 0 for each LED
</span><span class="n">duty_cycles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">led_pins</span><span class="p">]</span>

<span class="c1"># Last Pressed
</span><span class="n">last_pressed</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">button_pins</span><span class="p">]</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">btn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">buttons</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">btn</span><span class="p">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">duty_cycles</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="mi">65025</span>
            <span class="n">last_pressed</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span> <span class="k">if</span> <span class="n">last_pressed</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">last_pressed</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">lp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">last_pressed</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lp</span> <span class="o">==</span> <span class="mi">25</span><span class="p">:</span>
            <span class="c1"># print("button %d pressed" % ix)
</span>            <span class="n">keyboard</span><span class="p">.</span><span class="n">press</span><span class="p">(</span><span class="o">*</span><span class="n">button_mapping</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
            
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">lp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">last_pressed</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># print("button %d released" % ix)
</span>            <span class="n">keyboard</span><span class="p">.</span><span class="n">release</span><span class="p">(</span><span class="o">*</span><span class="n">button_mapping</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>

    <span class="n">last_pressed</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">lp</span> <span class="ow">in</span> <span class="n">last_pressed</span><span class="p">]</span>
     
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">led</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leds</span><span class="p">):</span>
        <span class="n">led</span><span class="p">.</span><span class="n">duty_cycle</span> <span class="o">=</span> <span class="n">duty_cycles</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="n">duty_cycles</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">duty_cycles</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</code></pre></div></div>

<p>When using this code, the LED under each button will light up as soon as you press a button and then quickly fade out. 
The fade out speed can be changed by changing 900 in <code class="language-plaintext highlighter-rouge">duty_cycles[ix] = max(duty_cycles[ix] - 900, 0)</code> to a higher
or lower value to fade quicker or slower respectively.</p>

<video class="tab" style="width:100%" controls="">Your browser does not support the &lt;video&gt; tag.
    <source src="/assets/posts/2021-04-05-Macropad/macropad_leds.mp4" />
</video>

<p>For my setup I’ve linked buttons 1-9 with CTRL+F1 - CTRL+F9 which are common shortcuts in multiple programs (e.g. 
CTRL+F4 will close the current tab in Chrome, CTRL+F5 is a hard refresh, …) and these can be bound to links on the
desktop too. Though ultimately these could be anything, just modify the mapping in the code and done.</p>

<h2 id="closing-the-case">Closing the case</h2>

<p>Once you are sure everything works, put everything in the case carefully. Soldered joints can be fragile so be gentle with
the wiring and make sure not to apply force as this could break connections. You’ll need a few dots of hot glue to keep the Pi Pico
in place in the bottom half of the case. Use the M3 bolts to screw the case close. There is no thread, though it should work
well enough as the bolt will grab the ridges in the 3D printed holes, just don’t open and close the case more than 
necessary as this will wear fast.</p>

<h2 id="conclusion">Conclusion</h2>

<p>By 3D printing the case, using spare switches and keycaps this was a pretty cheap project for me and it works quite well. There
is little to no lag when pressing a button. It would be cool to make the software more complex. Having multiple
configurations and switching between them using combinations of keys could be a nifty feature, but for now nine extra
buttons will have to suffice. Something more complex will be for a future post.</p>

<h2 id="links">Links</h2>

<ul>
  <li><a href="https://www.thingiverse.com/thing:4816077">My Case on Thingiverse</a> a remix from:
    <ul>
      <li><a href="https://www.thingiverse.com/thing:4222157">VOID9’s 3x3 MacroPad</a></li>
      <li><a href="https://core-electronics.com.au/tutorials/3d-printable-case-for-raspberry-pi-pico.html">Pico Armour Case</a></li>
    </ul>
  </li>
  <li><a href="https://www.thingiverse.com/thing:2815698">Gateron Switch Opener</a></li>
  <li><a href="https://www.youtube.com/watch?v=MjCFJCfq8ko">Setting up Thonny, CircuitPython and Adafruit HID</a></li>
  <li><a href="https://www.youtube.com/watch?v=aEWptdD32iA">Raspberry Pi Pico - DIY Macro Keyboard</a></li>
  <li><a href="https://github.com/adafruit/Adafruit_CircuitPython_HID">Adafruit HID</a> library</li>
  <li><a href="https://circuitpython.readthedocs.io/">CircuitPython</a></li>
</ul>


</article>



<section class="tags">
	<strong><i class="fa fa-tags"></i> Tags:</strong> <a href="/tag/raspberry-pi">raspberry-pi</a>,&nbsp;<a href="/tag/python">python</a>,&nbsp;<a href="/tag/mechanical-keyboard">mechanical-keyboard</a>,&nbsp;<a href="/tag/soldering">soldering</a>,&nbsp;<a href="/tag/electronics">electronics</a>
</section>



<section class="rss">
	
	<p class="rss-subscribe text">Liked this post ? <strong><a href="https://buymeacoffee.com/4dcube">You can buy me a coffee <i class="fa fa-coffee"></i></a></strong></p>
	
</section>

<section class="share">
  <span>Share: </span>
  
    
    
      <a href="//twitter.com/share?text=A+Python+powered+MacroPad%2FStreamDeck&url=https%3A%2F%2Fblog.4dcu.be%2Fdiy%2F2021%2F04%2F05%2FMacropad.html&via=ProostSebastian"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
        <i class="fa fa-twitter-square fa-lg"></i>
      </a>
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
      <a href="//www.facebook.com/sharer.php?t=A+Python+powered+MacroPad%2FStreamDeck&u=https%3A%2F%2Fblog.4dcu.be%2Fdiy%2F2021%2F04%2F05%2FMacropad.html"
        onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    
    
    
    
    
    
  
    
    
    
    
    
      <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.4dcu.be%2Fdiy%2F2021%2F04%2F05%2FMacropad.html"
        onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;">
        <i class="fa fa-linkedin-square fa-lg"></i>
      </a>
    
    
    
    
  
</section>

	<section class="post-navigation" data-pagefind-ignore>
		<span class="prev-post">
			
				<a href="/diy/2021/03/24/MQTT.html">
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-left fa-stack-1x fa-inverse"></i>
					</span>
					<span class="page-number">Adding Aqara Sensors to Home Assistant</span>
				</a>
			
		</span>
		<span class="next-post">
			
				<a href="/programming/2021/04/21/Code-Nugget-Batch_Effects.html">
					<span class="page-number">Fighting Batch Effects with pyComBat</span>
					<span class="fa-stack fa-lg">
						<i class="fa fa-square fa-stack-2x"></i>
						<i class="fa fa-angle-double-right fa-stack-1x fa-inverse"></i>
					</span>
				</a>
			
		</span>
	</section>


</div>
</div>

    </div>

		<div class="modal micromodal-slide" id="modal-1" aria-hidden="true">
	<div class="modal__overlay" tabindex="-1" data-micromodal-close>
		<div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">
			<header class="modal__header">
				<h2 class="modal__title" id="modal-1-title">
					Contact
				</h2>
			</header>
			<main class="modal__content" id="modal-1-content">
				<p>Have any comments or suggestions, your are welcome to reach out !</p>
				<ul class="modal__list">
						<li>
	<i class="fa fa-envelope-o"></i>
	<a href="mailto:sebastian.proost@gmail.com">
		<span class="username">sebastian.proost@gmail.com</span>
	</a>
</li>


	
	<li>
		<i class="fa fa-twitter"></i>
		<a href="https://twitter.com/ProostSebastian" title="Follow me on Twitter">
			<span class="username">ProostSebastian</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/4dcu-be" title="Fork me on GitHub">
			<span class="username">4dcu-be</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/sepro" title="Fork me on GitHub">
			<span class="username">sepro</span>
		</a>
	</li>
	

	

	


				</ul>
				
				<br />
				<p>Do you like this blog and wish to contribute? You could <a href="https://buymeacoffee.com/4dcube">Buy me a Coffee <i class="fa fa-coffee"></i></a>!</p>
				
			</main>
			<footer class="modal__footer">
				<button class="modal__btn modal__btn-primary" data-micromodal-close="" aria-label="Close this dialog window">Close</button>
			</footer>
		</div>
	</div>
</div>

		<div class="modal micromodal-slide" id="modal-2" aria-hidden="true">
	<div class="modal__overlay" tabindex="-1" data-micromodal-close>
		<div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-2-title">
			<header class="modal__header">
				<h2 class="modal__title" id="modal-2-title">
					Search
				</h2>
			</header>
			<main class="modal__content" id="modal-2-content">
				<div id="search"></div>
			</main>
			<footer class="modal__footer">
					<button class="modal__btn modal__btn-primary" data-micromodal-close="" aria-label="Close this dialog window">Close</button>
			</footer>
		</div>
	</div>
</div>


    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">4DCu.be</h3>

		<div>
			<div class="site-navigation">

				<p><strong>Site Map</strong></p>
				<ul class="pages">
					
				<li class="nav-link"><a href="/about/">About</a>
	
				<li class="nav-link"><a href="/gallery/">Gallery</a>
	
				<li class="nav-link"><a href="/posts/">Posts</a>
	
				<li class="nav-link"><a href="#" class="nav-link-contact">Contact</a></li>

				</ul>
				<br />
				<p><strong>Legal</strong></p>
				<p><a href="/policy/">Privacy policy</a></p>
			</div>

			<div class="site-contact">
				<p><strong>Contact</strong></p>
				<ul class="social-media-list">
					<li>
	<i class="fa fa-envelope-o"></i>
	<a href="mailto:sebastian.proost@gmail.com">
		<span class="username">sebastian.proost@gmail.com</span>
	</a>
</li>


	
	<li>
		<i class="fa fa-twitter"></i>
		<a href="https://twitter.com/ProostSebastian" title="Follow me on Twitter">
			<span class="username">ProostSebastian</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/4dcu-be" title="Fork me on GitHub">
			<span class="username">4dcu-be</span>
		</a>
	</li>
	

	
	<li>
		<i class="fa fa-github"></i>
		<a href="https://github.com/sepro" title="Fork me on GitHub">
			<span class="username">sepro</span>
		</a>
	</li>
	

	

	


				</ul>
			</div>

			<div class="site-signature">
				
				<p><strong>Contribute</strong></p>
				<p><i class="fa fa-coffee"></i> <a href="https://buymeacoffee.com/4dcube">Buy me a Coffee </a></p>
				
				<p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p>
				
			</div>
		</div>


  </div>

</footer>

<!-- Scripts -->
<script
  src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
  crossorigin="anonymous"></script>
<script src="/js/lightgallery.min.js"></script>
<script src="https://unpkg.com/micromodal/dist/micromodal.min.js"></script>
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    enableMenu: false
  },
  tex: {
    packages: ['base', 'ams']
  },
  loader: {
    load: ['ui/menu', '[tex]/ams']
  }
};
</script>
<script type="text/javascript" id="MathJax-script"
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.min.js">
</script>
<script>
	AOS.init({
   once: true,
   offset: -20,
   duration: 600
	});
</script>


<script type="text/javascript">
$(document).ready(function() {
  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });

});

</script>
<script type="text/javascript">
$(document).ready(function() {
		$(".post-content").lightGallery({
			 thumbnail:false,
			 selector: '.lightgallery-link'
		});
});
</script>

<!-- Contact Modal -->
<script type="text/javascript">
$(document).ready(function() {
	MicroModal.init();

	$('.nav-link-contact').click(function(ev) {
	  ev.preventDefault();
	  MicroModal.show('modal-1', {
	  		onClose: function() { $('.nav-link-contact').blur(); },
	  		disableFocus: true
	  });
	});

	$('.nav-link-search').click(function(ev) {
	  ev.preventDefault();

	  MicroModal.show('modal-2', {
	  		onClose: function() { $('.nav-link-contact').blur(); },
	  		disableFocus: true
	  });

	  document.querySelector('.pagefind-ui__search-input').focus();
	});

});
</script>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        new PagefindUI({ element: "#search" });
    });
</script>






  </body>

</html>
