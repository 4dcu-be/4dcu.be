// Gallery Component
// Modern gallery layouts using Bulma CSS Grid with hover animations

@use "sass:math";
@use "../custom-variables" as *;

// ========================================
// Gallery Items Container
// ========================================

.gallery-items {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.5rem;
  margin: 2rem 0;
  line-height: 0;
  width: 100%;

  @media screen and (min-width: $tablet) {
    grid-template-columns: repeat(3, 1fr);
  }

  @media screen and (min-width: $desktop) {
    grid-template-columns: repeat(4, 1fr);
    gap: 0.75rem;
  }
}

// ========================================
// Gallery Item (Individual Image)
// ========================================

.gallery-item {
  position: relative;
  overflow: hidden;
  background-color: #000;
  border: 2px solid $white;
  aspect-ratio: 4 / 3;
  display: flex;
  align-items: center;
  justify-content: center;

  img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    display: block;
    line-height: 0;
    transform: scale(1.05);
    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
  }

  // Hover effect: zoom in and fade
  &:hover img {
    transform: scale(1.19);
    opacity: 0.5;
  }

  // Lightgallery link styling
  a {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
    text-decoration: none;
    cursor: pointer;

    &:focus {
      outline: 2px solid $action-color;
      outline-offset: -2px;
    }

    img {
      position: relative;
      width: auto;
      height: auto;
      min-width: 100%;
      min-height: 100%;
      object-fit: cover;
      object-position: center;
      transition: transform 0.3s ease-in-out;
    }

    &:hover img {
      transform: scale(1.1);
    }
  }
}

// ========================================
// Gallery with 3 Columns (Custom Class)
// ========================================

.gallery-3-col {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
  margin: 2rem 0;
  width: 100%;

  @media screen and (min-width: $mobile) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media screen and (min-width: $tablet) {
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  // Direct img children (not wrapped)
  > img {
    width: 100%;
    height: auto;
    aspect-ratio: 4 / 3;
    object-fit: cover;
    object-position: center;
    display: block;
    border: 2px solid $base-border-color;
    border-radius: $radius;
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    margin: 0;

    &:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
  }

  // Images inside paragraph tags (common markdown)
  p {
    margin: 0;
    display: contents; // This makes the image a grid child, not the p tag
  }

  p > img {
    width: 100%;
    height: auto;
    aspect-ratio: 4 / 3;
    object-fit: cover;
    object-position: center;
    display: block;
    border: 2px solid $base-border-color;
    border-radius: $radius;
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    margin: 0;

    &:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
  }

  // LightGallery wrapping (a > img)
  > a {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: $radius;
    border: 2px solid $base-border-color;
    aspect-ratio: 4 / 3;
    background-color: #000;
    position: relative;

    img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: auto;
      height: auto;
      min-width: 100%;
      min-height: 100%;
      margin: 0;
      object-fit: cover;
      object-position: center;
      transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    }

    &:hover img {
      transform: translate(-50%, -50%) scale(1.05);
    }
  }
}

// ========================================
// Gallery with 2 Columns
// ========================================

.gallery-2-col {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
  margin: 2rem 0;
  width: 100%;

  @media screen and (min-width: $tablet) {
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  // Direct img children (not wrapped)
  > img {
    width: 100%;
    height: auto;
    aspect-ratio: 4 / 3;
    object-fit: cover;
    object-position: center;
    display: block;
    border: 2px solid $base-border-color;
    border-radius: $radius;
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    margin: 0;

    &:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
  }

  // Images inside paragraph tags (common markdown)
  p {
    margin: 0;
    display: contents;
  }

  p > img {
    width: 100%;
    height: auto;
    aspect-ratio: 4 / 3;
    object-fit: cover;
    object-position: center;
    display: block;
    border: 2px solid $base-border-color;
    border-radius: $radius;
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    margin: 0;

    &:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
  }

  // LightGallery wrapping (a > img)
  > a {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: $radius;
    border: 2px solid $base-border-color;
    aspect-ratio: 4 / 3;
    background-color: #000;
    position: relative;

    img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: auto;
      height: auto;
      min-width: 100%;
      min-height: 100%;
      margin: 0;
      object-fit: cover;
      object-position: center;
      transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    }

    &:hover img {
      transform: translate(-50%, -50%) scale(1.05);
    }
  }
}

// ========================================
// Gallery Lightbox Container (LightGallery)
// ========================================

.lightgallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 1rem;
  margin: 2rem 0;

  @media screen and (min-width: $tablet) {
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  a {
    display: block;
    overflow: hidden;
    border-radius: $radius;
    border: 2px solid $base-border-color;
    background-color: #000;
    position: relative;
    aspect-ratio: 1 / 1;

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      display: block;
      transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
      opacity: 0.9;
    }

    &:hover img {
      transform: scale(1.08);
      opacity: 1;
    }
  }
}

// ========================================
// Fullwidth Gallery (Hero-like)
// ========================================

.gallery-fullwidth {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
  margin: 2rem 0;
  width: 100%;

  a {
    display: block;
    overflow: hidden;
    border-radius: $radius;
    border: 2px solid $base-border-color;

    img {
      width: 100%;
      height: auto;
      object-fit: cover;
      object-position: center;
      display: block;
      transition: transform 0.3s ease-in-out;

      &:hover {
        transform: scale(1.02);
      }
    }
  }
}

// ========================================
// Image Grid (Generic)
// ========================================

.image-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1rem;
  margin: 2rem 0;

  @media screen and (min-width: $tablet) {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  img {
    width: 100%;
    height: auto;
    object-fit: cover;
    object-position: center;
    display: block;
    border-radius: $radius;
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;

    &:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
  }
}

// ========================================
// Masonry Gallery Layout
// ========================================

.gallery-masonry {
  column-count: 1;
  column-gap: 1rem;
  margin: 2rem 0;

  @media screen and (min-width: $tablet) {
    column-count: 2;
  }

  @media screen and (min-width: $desktop) {
    column-count: 3;
  }

  a, img {
    display: block;
    margin-bottom: 1rem;
    break-inside: avoid;
    width: 100%;
    border-radius: $radius;
  }

  img {
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;

    &:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
  }
}

// ========================================
// Gallery Page Override (Break Out of .page Constraints)
// ========================================

// The .page class constrains content to 900px max-width, but galleries need more space
// We override this to allow galleries to use the full wrapper width (1200px)
.page .post-content {
  // Allow gallery-items to expand beyond the page container
  overflow: visible;
}

.page .post-content .gallery-items {
  // Calculate the width needed to break out of the .page constraint
  // .page has max-width: 900px with 1rem padding on each side
  // We want to expand to .wrapper's max-width: 1200px with 1rem padding
  // Negative margins pull the gallery outside the page container

  width: auto;
  max-width: none;

  // Break out of the page's 900px constraint
  // Page has 1rem padding, so we need to expand by (1200 - 900) / 2 on each side
  margin-left: -150px;
  margin-right: -150px;

  @media screen and (max-width: 1200px) {
    // On smaller screens, don't extend beyond viewport edges
    // Use viewport-based calculation to stay within bounds
    $page-max: 900px;
    margin-left: calc((min(100vw, 1200px) - #{$page-max}) / -2);
    margin-right: calc((min(100vw, 1200px) - #{$page-max}) / -2);
  }

  @media screen and (max-width: $tablet) {
    // On tablet and below, don't break out - stay within page bounds
    margin-left: 0;
    margin-right: 0;
  }
}

// ========================================
// Mobile Responsiveness
// ========================================

@media screen and (max-width: $mobile) {
  .gallery-items {
    grid-template-columns: repeat(2, 1fr);
    gap: 0.375rem;
  }

  .gallery-3-col,
  .gallery-2-col {
    grid-template-columns: 1fr;
    gap: 0.375rem;
  }

  .lightgallery {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 0.375rem;
  }

  .image-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 0.375rem;
  }
}
